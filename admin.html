<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brandible Hub – Admin Dashboard</title>
  
  <!-- Google Fonts - Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Chart.js for Analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- JSZip for creating ZIP files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  
  <!-- FileSaver for downloading files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
  </style>
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.init();
    }
  </script>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <script defer src="/assets/js/auth.js"></script>
  <script defer src="/assets/js/admin.js"></script>

  <!-- Tailwind component layer -->
  <style type="text/tailwindcss">
    @layer components {
      .pill { @apply inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full font-medium; }
      .pill-green { @apply pill bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300; }
      .pill-amber { @apply pill bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300; }
      .pill-blue { @apply pill bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300; }
      .pill-slate { @apply pill bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300; }
      .card-body { @apply p-4 md:p-5; }
      .sidebar-link { @apply flex items-center gap-3 px-3 py-2 rounded-xl text-slate-600 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-white; }
      .sidebar-link-active { @apply bg-slate-900 text-white dark:bg-white dark:text-slate-900; }
    }
  </style>

  <script>
    // Dark mode toggle + persist
    (function(){
      const key = 'brandible.dark';
      const saved = localStorage.getItem(key);
      if (saved === '1') document.documentElement.classList.add('dark');
      window.toggleDark = () => {
        const d = document.documentElement.classList.toggle('dark');
        localStorage.setItem(key, d ? '1' : '0');
      }
    })();
  </script>
</head>
<body class="h-full gradient-bg dark:bg-slate-950 text-slate-900 dark:text-slate-100 fade-in">
  <div class="min-h-screen flex flex-col">
    <!-- Topbar -->
    <header class="glass-header sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 shadow-lg shadow-purple-500/30 flex items-center justify-center">
            <span class="text-2xl font-bold text-white">B</span>
          </div>
          <div>
            <h1 class="font-bold text-lg text-slate-900 dark:text-white mb-0.5">Brandible Hub</h1>
            <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Admin Dashboard</p>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <span id="userEmail" class="hidden md:inline text-sm font-medium text-slate-600 dark:text-slate-400"></span>
          <span class="pill-blue font-semibold">Admin</span>
          <button onclick="toggleDark()" class="btn-ghost p-2" title="Toggle dark mode">
            <span class="text-xl">🌗</span>
          </button>
          <button id="logoutBtn" class="btn-ghost text-sm font-medium">Log out</button>
        </div>
      </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-6 space-y-8">
      <!-- Section Tabs -->
      <nav class="flex items-center gap-2 overflow-x-auto pb-2">
        <button id="tabOverview" class="sidebar-link sidebar-link-active" onclick="showAdminSection('overview')">Overview</button>
        <button id="tabAnalytics" class="sidebar-link" onclick="showAdminSection('analytics')">Analytics</button>
        <button id="tabClients" class="sidebar-link" onclick="showAdminSection('clients')">Clients</button>
        <button id="tabBookings" class="sidebar-link" onclick="showAdminSection('bookings')">Bookings</button>
      </nav>
      <!-- Admin KPIs -->
        <section id="overviewSection">
          <h2 class="text-2xl font-bold mb-6">Overview</h2>
          <div id="adminKPIs" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
        </section>

      <!-- Analytics Section -->
      <section id="analyticsSection">
        <h2 class="text-2xl font-bold mb-6">Analytics</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Projects vs Invoices Doughnut Chart -->
          <div class="card fade-in">
            <div class="card-header">Project vs. Invoice Ratio</div>
            <div class="card-body p-6">
              <canvas id="doughnutChart" height="300"></canvas>
            </div>
          </div>
          
          <!-- Clients vs Active Projects Bar Chart -->
          <div class="card fade-in">
            <div class="card-header">Activity Distribution</div>
            <div class="card-body p-6">
              <canvas id="barChart" height="300"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Clients List -->
      <section id="clientsSection">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">All Clients</h2>
          <div class="flex items-center gap-3">
            <div class="relative flex-1 max-w-md">
              <input id="clientSearch" placeholder="Search clients..." class="w-full rounded-xl border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-4 py-2.5 pl-10 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
            <button onclick="openNewClientModal()" class="btn-primary whitespace-nowrap">
              <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              New Client
            </button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">Client List</div>
          <div class="card-body overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="bg-slate-50/50 dark:bg-slate-800/20">
                <tr>
                  <th class="text-left py-3 px-4 font-semibold text-xs text-slate-700 dark:text-slate-300 uppercase tracking-wider">Name</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs text-slate-700 dark:text-slate-300 uppercase tracking-wider">Email</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs text-slate-700 dark:text-slate-300 uppercase tracking-wider">Active Projects</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs text-slate-700 dark:text-slate-300 uppercase tracking-wider">Open Invoices</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs text-slate-700 dark:text-slate-300 uppercase tracking-wider">Last Update</th>
                  <th class="text-right py-3 px-4 font-semibold text-xs text-slate-700 dark:text-slate-300 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody id="clientsTable"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Bookings -->
      <section id="bookingsSection" class="hidden">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-bold">Bookings</h2>
          <div class="flex items-center gap-3">
            <div class="relative flex-1 max-w-md">
              <input id="bookingsSearch" placeholder="Search by name, email, or service..." class="w-full rounded-xl border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-4 py-2.5 pl-10 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
            <button id="refreshBookingsBtn" class="btn-ghost text-sm" title="Refresh">
              🔄
            </button>
          </div>
        </div>
          <div class="card">
          <div class="card-header">Recent Booking Submissions</div>
          <div class="card-body overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="sticky top-0 bg-slate-50/70 dark:bg-slate-800/50 backdrop-blur">
                <tr>
                  <th class="text-left py-3 px-4 font-semibold text-xs uppercase tracking-wider text-slate-700 dark:text-slate-300">Name</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs uppercase tracking-wider text-slate-700 dark:text-slate-300">Email</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs uppercase tracking-wider text-slate-700 dark:text-slate-300">Phone</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs uppercase tracking-wider text-slate-700 dark:text-slate-300">Service</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs uppercase tracking-wider text-slate-700 dark:text-slate-300">Message</th>
                  <th class="text-left py-3 px-4 font-semibold text-xs uppercase tracking-wider text-slate-700 dark:text-slate-300">Date</th>
                </tr>
              </thead>
              <tbody id="bookingsTable"></tbody>
            </table>
            <p id="bookingsEmpty" class="hidden text-sm text-slate-500 dark:text-slate-400 py-4">No leads have been received yet.</p>
          </div>
        </div>
      </section>

      <!-- Recent Activity Across All Clients -->
      <section>
        <h2 class="text-2xl font-bold mb-6">Recent Activity</h2>
        <div class="card">
          <ul id="allActivity" class="card-body space-y-3"></ul>
        </div>
      </section>
    </main>

    <footer class="px-4 py-6 text-center text-xs text-slate-500">
      © <span id="year"></span> Brandible. All rights reserved.
    </footer>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- Client Profile Modal -->
  <div id="clientModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[2000] hidden transition-all duration-300" onclick="closeModalOnBackdrop(event)">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/50 max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col transform transition-all duration-300 scale-100" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="card-header flex items-center justify-between border-b border-slate-200 dark:border-slate-800">
        <div>
          <h3 id="modalClientName" class="text-xl font-bold">Client Name</h3>
          <p id="modalClientEmail" class="text-sm text-slate-500"></p>
        </div>
        <div class="flex items-center gap-2">
          <button id="editBtn" onclick="toggleEditMode()" class="btn-ghost">Edit</button>
          <button onclick="closeModal()" class="btn-ghost text-xl">✕</button>
        </div>
      </div>
      
      <!-- Edit Mode Header -->
      <div id="editModeHeader" class="hidden card-header flex items-center justify-between border-b-2 border-indigo-500 bg-indigo-50 dark:bg-indigo-950">
        <div class="flex items-center gap-2">
          <span class="text-indigo-700 dark:text-indigo-300 font-medium">✏️ Edit Mode</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="cancelEditBtn" onclick="cancelEditMode()" class="btn-ghost">Cancel</button>
          <button id="saveBtn" onclick="saveClientChanges()" class="btn-primary">
            <span id="saveBtnText">Save Changes</span>
          </button>
        </div>
      </div>
      
      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-6 space-y-6">
        <!-- KPIs -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Overview</h4>
          <div id="modalKPIs" class="grid grid-cols-2 gap-4"></div>
        </section>
        
        <!-- Projects -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Projects</h4>
          <div id="modalProjects" class="space-y-3"></div>
        </section>
        
        <!-- Files -->
        <section>
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg font-semibold">Files</h4>
            <button onclick="downloadAllFilesForCurrentClient()" id="downloadAllBtn" class="hidden inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
              </svg>
              Download All
            </button>
          </div>
          <ul id="modalFiles" class="space-y-2"></ul>
          <p id="filesLastUpdated" class="text-xs text-slate-500 dark:text-slate-400 mt-3 hidden"></p>
        </section>
        
        <!-- Invoices -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Invoices</h4>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="text-slate-500">
                <tr>
                  <th class="text-left py-2">#</th>
                  <th class="text-left py-2">Date</th>
                  <th class="text-left py-2">Amount</th>
                  <th class="text-left py-2">Status</th>
                </tr>
              </thead>
              <tbody id="modalInvoices"></tbody>
            </table>
          </div>
        </section>
        
        <!-- Activity -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Recent Activity</h4>
          <ul id="modalActivity" class="space-y-2"></ul>
        </section>
        
        <!-- Client Activity -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Client Activity</h4>
          <ul id="modalClientActivity" class="space-y-2"></ul>
        </section>
        
        <!-- Updates -->
        <section id="modalUpdatesSection">
          <h4 class="text-lg font-semibold mb-3">Updates</h4>
          <ul id="modalUpdates" class="space-y-2"></ul>
        </section>
        
        <!-- Edit Section: KPIs -->
        <section id="editKPIsSection" class="hidden">
          <h4 class="text-lg font-semibold mb-3 text-indigo-700 dark:text-indigo-300">Edit KPIs</h4>
          <div class="card p-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Active Projects</label>
                <input type="number" id="editKPIProjects" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Files Shared</label>
                <input type="number" id="editKPIFiles" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Open Invoices</label>
                <input type="number" id="editKPIInvoices" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Last Update</label>
                <div class="relative">
                  <input type="date" id="editKPILastUpdate" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 pr-10 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
                  <svg class="absolute right-3 top-8 w-5 h-5 text-slate-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Edit Section: Add Activity -->
        <section id="editActivitySection" class="hidden">
          <h4 class="text-lg font-semibold mb-3 text-indigo-700 dark:text-indigo-300">Add Activity</h4>
          <div class="card p-4 space-y-4">
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Activity Type</label>
              <select id="newActivityType" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1">
                <option value="project">Project</option>
                <option value="file">File</option>
                <option value="invoice">Invoice</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Activity Description</label>
              <input type="text" id="newActivityText" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" placeholder="e.g., Uploaded new design file" />
            </div>
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">When</label>
              <input type="text" id="newActivityWhen" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" placeholder="e.g., 2 days ago" />
            </div>
            <button onclick="addActivityToClient()" class="btn-primary w-full">Add Activity</button>
          </div>
        </section>
      </div>
      
      <!-- Modal Footer -->
      <div class="card-header border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3">
        <button onclick="closeModal()" class="btn-primary">Close</button>
      </div>
    </div>
  </div>

  <!-- New Client Modal -->
  <div id="newClientModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[2000] hidden transition-all duration-300" onclick="closeNewClientModalOnBackdrop(event)">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/50 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col transform transition-all duration-300 scale-100" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="card-header flex items-center justify-between border-b border-slate-200/50 dark:border-slate-800/50 bg-gradient-to-r from-indigo-50/50 via-purple-50/50 to-pink-50/50 dark:from-indigo-950/20 dark:via-purple-950/20 dark:to-pink-950/20">
        <div>
          <h3 class="text-xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">Create New Client</h3>
          <p class="text-sm text-slate-500 dark:text-slate-400">Add a new client to the system</p>
        </div>
        <button onclick="closeNewClientModal()" class="btn-ghost text-xl hover:rotate-90 transition-transform duration-200">✕</button>
      </div>
      
      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Name *</label>
          <input type="text" id="newClientName" placeholder="Client Name" required class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Email *</label>
          <input type="email" id="newClientEmail" placeholder="client@example.com" required class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Active Projects</label>
            <input type="number" id="newClientProjects" value="0" placeholder="0" min="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Files Shared</label>
            <input type="number" id="newClientFiles" value="0" placeholder="0" min="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Open Invoices</label>
            <input type="number" id="newClientInvoices" value="0" placeholder="0" min="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Last Update</label>
            <input type="text" id="newClientLastUpdate" placeholder="e.g., Oct 2025 or leave blank for current date" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Notes (Optional)</label>
          <textarea id="newClientNotes" rows="3" placeholder="Any additional notes about this client..." class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
        </div>
      </div>
      
      <!-- Modal Footer -->
      <div class="card-header border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3">
        <button onclick="closeNewClientModal()" class="btn-ghost">Cancel</button>
        <button onclick="submitNewClient()" id="submitNewClientBtn" class="btn-primary">
          <span id="submitNewClientBtnText">Create Client</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Modal functions
    function closeModal() {
      document.getElementById('clientModal').classList.add('hidden');
    }
    
    function closeModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeModal();
      }
    }
    
    // New Client Modal functions
    function closeNewClientModal() {
      document.getElementById('newClientModal').classList.add('hidden');
    }
    
    function closeNewClientModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeNewClientModal();
      }
    }
    
    // Close on ESC key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
        closeNewClientModal();
        closeDeleteModal();
      }
    });
  </script>

  <!-- Loading Spinner -->
  <div id="loadingOverlay" class="fixed inset-0 flex items-center justify-center bg-slate-900/50 dark:bg-slate-950/80 backdrop-blur-sm z-[1000]">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl rounded-2xl p-8 shadow-2xl">
      <div class="animate-spin rounded-full h-12 w-12 border-4 border-gradient-to-r from-indigo-600 via-purple-600 to-indigo-600 border-t-transparent"></div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteConfirmModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[2500] hidden transition-all duration-300" onclick="closeDeleteModalOnBackdrop(event)">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/50 max-w-md w-full mx-4 overflow-hidden transform transition-all duration-300 scale-100" onclick="event.stopPropagation()">
      <div class="p-6">
        <div class="flex items-center gap-3 mb-4">
          <div class="size-12 rounded-full bg-red-100 dark:bg-red-900/40 flex items-center justify-center flex-shrink-0">
            <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
          </div>
          <div class="flex-1">
            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Remove Client</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400">This action cannot be undone</p>
          </div>
        </div>
        
        <p class="text-slate-700 dark:text-slate-300 mb-6">
          Are you sure you want to remove <span id="deleteClientName" class="font-semibold text-slate-900 dark:text-white"></span>? This will permanently delete their record and revoke access.
        </p>
        
        <div class="flex gap-3">
          <button onclick="closeDeleteModal()" class="flex-1 btn-ghost">
            Cancel
          </button>
          <button onclick="deleteClientConfirmed()" id="confirmDeleteBtn" class="flex-1 inline-flex items-center justify-center rounded-xl px-4 py-2.5 bg-gradient-to-r from-red-600 to-red-700 text-white font-medium shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40 transition-all">
            <span id="confirmDeleteBtnText">Confirm Delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-full opacity-0">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-2xl shadow-2xl border border-white/20 dark:border-slate-700/50 px-6 py-4 flex items-center gap-3 min-w-[320px] max-w-md">
      <div class="flex-shrink-0">
        <div id="toastIcon" class="size-8 rounded-full flex items-center justify-center"></div>
      </div>
      <div class="flex-1">
        <div id="toastMessage" class="font-medium text-slate-900 dark:text-slate-100"></div>
        <div id="toastDetail" class="text-sm text-slate-600 dark:text-slate-400"></div>
      </div>
      <button onclick="hideToast()" class="flex-shrink-0 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">✕</button>
    </div>
  </div>

  <script>
    // Toast notification functions
    function showToast(message, type = 'success', detail = '') {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toastIcon');
      const toastMessage = document.getElementById('toastMessage');
      const toastDetail = document.getElementById('toastDetail');
      
      toastMessage.textContent = message;
      toastDetail.textContent = detail || '';
      
      // Set icon and colors based on type
      if (type === 'success') {
        toastIcon.innerHTML = '✓';
        toastIcon.className = 'size-9 rounded-full flex items-center justify-center bg-gradient-to-br from-emerald-400 to-emerald-600 text-white shadow-lg shadow-emerald-500/50';
        toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-0 opacity-100';
      } else if (type === 'error') {
        toastIcon.innerHTML = '✕';
        toastIcon.className = 'size-9 rounded-full flex items-center justify-center bg-gradient-to-br from-red-400 to-red-600 text-white shadow-lg shadow-red-500/50';
        toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-0 opacity-100';
      }
      
      // Auto-hide after 3 seconds
      setTimeout(() => hideToast(), 3000);
    }
    
    function hideToast() {
      const toast = document.getElementById('toast');
      toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-full opacity-0';
    }
    
    // Make functions globally available
    window.showToast = showToast;
    window.hideToast = hideToast;
  </script>
</body>
</html>

