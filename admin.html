<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brandible Hub – Admin Dashboard</title>
  
  <!-- Google Fonts - Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  
  <!-- Chart.js for Analytics -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- Supabase JS Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- JSZip for creating ZIP files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  
  <!-- FileSaver for downloading files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
  </style>
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.init();
    }
  </script>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <script defer src="/assets/js/auth.js"></script>
  <script type="module" defer src="/assets/js/admin.js"></script>

  <!-- Tailwind component layer -->
  <style type="text/tailwindcss">
    @layer components {
      .pill { @apply inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full font-medium; }
      .pill-green { @apply pill bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300; }
      .pill-amber { @apply pill bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300; }
      .pill-blue { @apply pill bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300; }
      .pill-slate { @apply pill bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300; }
      .card-body { @apply p-4 md:p-5; }
      .sidebar-link { @apply flex items-center gap-3 px-3 py-2 rounded-xl text-slate-600 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-white; }
      .sidebar-link-active { @apply bg-slate-900 text-white dark:bg-white dark:text-slate-900; }
    }
  </style>

  <script>
    // Dark mode toggle + persist
    function toggleDark() {
      const key = 'brandible.dark';
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem(key, isDark ? '1' : '0');
      console.log('Dark mode toggled:', isDark);
    }
    
    // Initialize dark mode on page load
    (function(){
      const key = 'brandible.dark';
      const saved = localStorage.getItem(key);
      if (saved === '1') document.documentElement.classList.add('dark');
      // Make toggleDark globally available
      window.toggleDark = toggleDark;
    })();
  </script>
</head>
<body class="h-full gradient-bg dark:bg-slate-950 text-slate-900 dark:text-slate-100 fade-in">
  <div class="min-h-screen flex flex-col">
    <!-- Topbar -->
    <header class="glass-header sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 shadow-lg shadow-purple-500/30 flex items-center justify-center">
            <span class="text-2xl font-bold text-white">B</span>
          </div>
          <div>
            <h1 class="font-bold text-lg mb-0.5 brandible-gradient-text">Brandible Hub</h1>
            <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">Admin Dashboard</p>
          </div>
        </div>
        <div class="flex items-center gap-2 sm:gap-3">
          <span id="userEmail" class="hidden lg:inline text-sm font-medium text-slate-600 dark:text-slate-400"></span>
          <span class="pill-blue font-semibold hidden sm:inline">Admin</span>
          <button onclick="toggleDark()" class="btn-ghost p-2 sm:p-3" title="Toggle dark mode">
            <span class="text-lg sm:text-xl">🌗</span>
          </button>
          <button onclick="window.refreshAdmin && window.refreshAdmin()" class="btn-ghost text-xs sm:text-sm font-medium px-2 sm:px-4" title="Refresh">
            🔄 Refresh
          </button>
          <button id="logoutBtn" class="btn-ghost text-xs sm:text-sm font-medium px-2 sm:px-4">Log out</button>
        </div>
      </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-2 sm:px-4 py-4 sm:py-6 space-y-6 sm:space-y-8">
      <!-- Sticky navbar with anchor links for single-page scroll -->
      <nav class="sticky top-[60px] z-30 bg-white/70 dark:bg-slate-950/70 backdrop-blur supports-[backdrop-filter]:bg-white/60 rounded-xl px-2 py-2 flex items-center gap-2 overflow-x-auto border border-slate-200/50 dark:border-slate-800/50">
        <a href="#overviewSection" class="sidebar-link sidebar-link-active">Overview</a>
        <a href="#analyticsSection" class="sidebar-link">Analytics</a>
        <a href="#clientsSection" class="sidebar-link">Clients</a>
        <a href="#bookingsSection" class="sidebar-link">Leads</a>
      </nav>
      <!-- Overview Section -->
      <section id="overviewSection">
        <div class="mb-8">
          <h2 class="text-3xl font-bold mb-8" style="color: #1F1F1F;">Overview</h2>
          <!-- New KPI Cards Container -->
          <div id="kpiContainer" class="mb-6"></div>
        </div>
        
        <!-- Keep existing KPIs for backward compatibility -->
        <div id="adminKPIs" class="hidden"></div>
      </section>

      <!-- Analytics Section -->
      <section id="analyticsSection">
        <h2 class="text-2xl font-bold mb-6">Analytics</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div id="revenueChartContainer"></div>
          <div id="leadSourceChartContainer"></div>
        </div>
      </section>

      <!-- Clients -->
      <section id="clientsSection">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-2xl font-bold">All Clients</h2>
          <div class="relative w-full max-w-md">
            <input id="clientSearch" placeholder="Search clients..." class="w-full rounded-xl border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-4 py-2.5 pl-10 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
            <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
        <div class="flex items-center justify-end mb-4">
          <button id="openAddClientModal" class="btn-primary whitespace-nowrap">
            <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            New Client
          </button>
        </div>
        <div id="clientCardsContainer"></div>
      </section>

      <!-- Leads -->
      <section id="bookingsSection">
        <div class="mb-4 sm:mb-6">
          <h2 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6">Leads</h2>
          <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3">
            <button onclick="exportLeadsToCSV()" class="btn-ghost text-xs sm:text-sm whitespace-nowrap px-3 py-2" title="Export to CSV">
              📥 Export CSV
            </button>
            <div class="relative flex-1">
              <input id="bookingsSearch" placeholder="Search leads..." class="w-full rounded-xl border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 sm:px-4 py-2 sm:py-2.5 pl-8 sm:pl-10 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all text-sm" />
              <svg class="absolute left-2 sm:left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
            <select id="sortLeadsDropdown" class="rounded-xl border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 sm:px-4 py-2 sm:py-2.5 outline-none focus:ring-2 focus:ring-purple-500/50 transition-all text-xs sm:text-sm">
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
            </select>
            <button id="refreshBookingsBtn" class="btn-ghost text-sm p-2 sm:p-3" title="Refresh">
              🔄
            </button>
          </div>
        </div>
        <div id="leadsContainer"></div>
      </section>

      <!-- Recent Activity Across All Clients -->
      <section>
        <h2 class="text-2xl font-bold mb-6">Recent Activity</h2>
        <div id="activityFeedContainer"></div>
      </section>
    </main>

    <footer class="px-4 py-6 text-center text-xs text-slate-500">
      © <span id="year"></span> Brandible. All rights reserved.
    </footer>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- Admin Profile Editor Modal -->
  <div id="profileEditorModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[2600] hidden transition-all duration-300" onclick="closeProfileEditorOnBackdrop(event)">
    <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl border border-slate-200/50 dark:border-slate-800/50 w-full max-w-lg mx-4 overflow-hidden" onclick="event.stopPropagation()">
      <div class="p-6 border-b border-slate-200/50 dark:border-slate-800/50 flex items-center justify-between">
        <h3 class="text-lg font-semibold">Edit Client Profile</h3>
        <button onclick="closeProfileEditor()" class="btn-ghost text-xl">✕</button>
      </div>
      <div class="p-6 space-y-4">
        <div class="flex items-center gap-4">
          <img id="profilePreview" src="/assets/default-avatar.png" class="w-24 h-24 rounded-full object-cover border-2 border-indigo-500 shadow" />
          <div>
            <input id="profileImageInput" type="file" accept="image/*" class="block text-sm" />
            <p class="text-xs text-slate-500 mt-1">Upload a square image for best results.</p>
          </div>
        </div>
        <div class="grid grid-cols-1 gap-3">
          <div>
            <label class="text-sm font-medium">Full Name</label>
            <input id="profileName" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="text-sm font-medium">Company</label>
            <input id="profileCompany" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="text-sm font-medium">Manager</label>
            <input id="profileManager" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="text-sm font-medium">Email</label>
            <input id="profileEmail" readonly class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-3 py-2" />
          </div>
          <div>
            <label class="text-sm font-medium">Phone</label>
            <input id="profilePhone" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="text-sm font-medium">Website</label>
            <input id="profileWebsite" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>
      </div>
      <div class="p-6 border-t border-slate-200/50 dark:border-slate-800/50 flex justify-end gap-2">
        <button onclick="closeProfileEditor()" class="btn-ghost">Cancel</button>
        <button id="profileSaveBtn" onclick="saveAdminProfileChanges()" class="btn-primary"><span id="profileSaveBtnText">Save Changes</span></button>
      </div>
    </div>
  </div>

  <!-- Client Profile Modal -->
  <div id="clientModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[2000] hidden transition-all duration-300" onclick="closeModalOnBackdrop(event)">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/50 max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col transform transition-all duration-300 scale-100" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="card-header flex items-center justify-between border-b border-slate-200 dark:border-slate-800">
        <div>
          <h3 id="modalClientName" class="text-xl font-bold">Client Name</h3>
          <p id="modalClientEmail" class="text-sm text-slate-500"></p>
        </div>
        <div class="flex items-center gap-2">
          <button id="editBtn" onclick="toggleEditMode()" class="btn-ghost">Edit</button>
          <button onclick="closeModal()" class="btn-ghost text-xl">✕</button>
        </div>
      </div>
      
      <!-- Edit Mode Header -->
      <div id="editModeHeader" class="hidden card-header flex items-center justify-between border-b-2 border-indigo-500 bg-indigo-50 dark:bg-indigo-950">
        <div class="flex items-center gap-2">
          <span class="text-indigo-700 dark:text-indigo-300 font-medium">✏️ Edit Mode</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="cancelEditBtn" onclick="cancelEditMode()" class="btn-ghost">Cancel</button>
          <button id="saveBtn" onclick="saveClientChanges()" class="btn-primary">
            <span id="saveBtnText">Save Changes</span>
          </button>
        </div>
      </div>
      
      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-6 space-y-6">
        <!-- Profile Section -->
        <section class="pb-6 border-b border-slate-200 dark:border-slate-800">
          <!-- View Mode -->
          <div id="profileViewMode" class="flex items-start gap-4">
            <img id="adminProfileImagePreview" src="/assets/default-avatar.png" alt="Profile" class="w-20 h-20 rounded-full object-cover border-2 border-slate-300 dark:border-slate-600 shadow-md flex-shrink-0" />
            <div class="flex-1 min-w-0">
              <h4 id="adminClientNameDisplay" class="text-lg font-semibold text-slate-900 dark:text-white mb-1"></h4>
              <p id="adminClientEmailDisplay" class="text-sm text-slate-500 dark:text-slate-400 mb-2"></p>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-1 text-sm">
                <div id="adminClientCompanyDisplay" class="text-slate-600 dark:text-slate-300"></div>
                <div id="adminClientManagerDisplay" class="text-slate-600 dark:text-slate-300"></div>
                <div id="adminClientPhoneDisplay" class="text-slate-600 dark:text-slate-300"></div>
                <div id="adminClientWebsiteDisplay" class="text-slate-600 dark:text-slate-300"></div>
              </div>
            </div>
          </div>
          
          <!-- Edit Mode -->
          <div id="profileEditMode" class="hidden">
            <div class="flex items-start gap-4 mb-4">
              <div class="relative">
                <img id="adminProfileImagePreviewEdit" src="/assets/default-avatar.png" alt="Profile" class="w-20 h-20 rounded-full object-cover border-2 border-indigo-500 shadow-md" />
                <label for="adminClientAvatarUpload" class="absolute bottom-0 right-0 bg-indigo-500 text-white rounded-full p-1.5 cursor-pointer hover:bg-indigo-600 transition shadow-lg" title="Change Photo">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 001.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                </label>
                <input id="adminClientAvatarUpload" type="file" accept="image/*" class="hidden" />
              </div>
              <div class="flex-1">
                <div class="mb-3">
                  <label class="text-xs font-medium text-slate-600 dark:text-slate-400 uppercase tracking-wider mb-1 block">Full Name</label>
                  <input id="adminClientName" type="text" class="text-lg font-semibold w-full border-b-2 border-transparent focus:border-indigo-500 dark:focus:border-indigo-400 outline-none bg-transparent pb-1 transition-colors" placeholder="Client Name" />
                </div>
                <div class="mb-3">
                  <label class="text-xs font-medium text-slate-600 dark:text-slate-400 uppercase tracking-wider mb-1 block">Email</label>
                  <input id="adminClientEmail" type="text" class="text-sm text-slate-500 dark:text-slate-400 w-full bg-transparent outline-none" disabled />
                </div>
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-1 block">Company</label>
                <input id="adminClientCompany" type="text" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Company name" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-1 block">Manager</label>
                <input id="adminClientManager" type="text" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Assigned manager" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-1 block">Phone</label>
                <input id="adminClientPhone" type="text" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Phone number" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-1 block">Website</label>
                <input id="adminClientWebsite" type="text" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Website URL" />
              </div>
            </div>
          </div>
        </section>
        
        <!-- KPIs -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Overview</h4>
          <div id="modalKPIs" class="grid grid-cols-2 gap-4"></div>
        </section>
        
        <!-- Projects -->
        <section>
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg font-semibold">Projects</h4>
            <button id="addProjectBtn" class="hidden btn-primary text-sm px-4 py-2" onclick="addNewProjectCard()">
              <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Add Project
            </button>
          </div>
          <div id="modalProjects" class="space-y-3"></div>
        </section>
        
        <!-- Files -->
        <section>
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg font-semibold">Files</h4>
            <button onclick="downloadAllFilesForCurrentClient()" id="downloadAllBtn" class="hidden inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
              </svg>
              Download All
            </button>
          </div>
          <ul id="modalFiles" class="space-y-2"></ul>
          <p id="filesLastUpdated" class="text-xs text-slate-500 dark:text-slate-400 mt-3 hidden"></p>
        </section>
        
        <!-- Invoices -->
        <section>
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-lg font-semibold">Invoices</h4>
            <button id="createInvoiceBtn" class="btn-primary text-sm px-4 py-2">
              <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              Create Invoice
            </button>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="text-slate-500">
                <tr>
                  <th class="text-left py-2">#</th>
                  <th class="text-left py-2">Issued</th>
                  <th class="text-left py-2">Due</th>
                  <th class="text-left py-2">Amount</th>
                  <th class="text-left py-2">Status</th>
                  <th class="text-right py-2">Actions</th>
                </tr>
              </thead>
              <tbody id="modalInvoices"></tbody>
            </table>
          </div>
        </section>
        
        <!-- Activity -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Recent Activity</h4>
          <ul id="modalActivity" class="space-y-2"></ul>
        </section>
        
        <!-- Client Activity -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Client Activity</h4>
          <ul id="modalClientActivity" class="space-y-2"></ul>
        </section>
        
        <!-- Updates -->
        <section id="modalUpdatesSection">
          <h4 class="text-lg font-semibold mb-3">Updates</h4>
          <ul id="modalUpdates" class="space-y-2"></ul>
        </section>
        
        <!-- Edit Section: KPIs -->
        <section id="editKPIsSection" class="hidden">
          <h4 class="text-lg font-semibold mb-3 text-indigo-700 dark:text-indigo-300">Edit KPIs</h4>
          <div class="card p-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Active Projects</label>
                <input type="number" id="editKPIProjects" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Files Shared</label>
                <input type="number" id="editKPIFiles" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Open Invoices</label>
                <input type="number" id="editKPIInvoices" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Last Update</label>
                <div class="relative">
                  <input type="date" id="editKPILastUpdate" class="w-full rounded-lg border border-slate-200/50 dark:border-slate-700/50 bg-white/70 dark:bg-slate-900/50 px-3 py-2 mt-1 pr-10 outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-300 dark:focus:border-purple-700 transition-all" />
                  <svg class="absolute right-3 top-8 w-5 h-5 text-slate-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Edit Section: Add Activity -->
        <section id="editActivitySection" class="hidden">
          <h4 class="text-lg font-semibold mb-3 text-indigo-700 dark:text-indigo-300">Add Activity</h4>
          <div class="card p-4 space-y-4">
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Activity Type</label>
              <select id="newActivityType" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1">
                <option value="project">Project</option>
                <option value="file">File</option>
                <option value="invoice">Invoice</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Activity Description</label>
              <input type="text" id="newActivityText" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" placeholder="e.g., Uploaded new design file" />
            </div>
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">When</label>
              <input type="text" id="newActivityWhen" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" placeholder="e.g., 2 days ago" />
            </div>
            <button onclick="addActivityToClient()" class="btn-primary w-full">Add Activity</button>
          </div>
        </section>
      </div>
      
      <!-- Modal Footer -->
      <div class="card-header border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3">
        <button onclick="closeModal()" class="btn-primary">Close</button>
      </div>
    </div>
  </div>

  <!-- Create Client Modal (New Enhanced) -->
  <div id="createClientModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-lg relative transition-all duration-300 border border-slate-200/60 dark:border-slate-800/60">
      <h2 class="text-xl font-semibold text-slate-800 dark:text-slate-100 mb-4">Create New Client</h2>

      <!-- Avatar Upload -->
      <div class="flex flex-col items-center mb-6">
        <label for="avatarUpload" class="relative cursor-pointer">
          <img id="avatarPreview" src="/assets/default-avatar.png" alt="Preview" class="h-20 w-20 rounded-full object-cover border-2 border-slate-200 dark:border-slate-700 shadow-sm" />
          <input type="file" id="avatarUpload" class="hidden" accept="image/*" />
        </label>
        <span class="text-xs text-slate-500 mt-2">Upload profile photo (optional)</span>
      </div>

      <!-- Client Info -->
      <div class="space-y-4">
        <input id="clientName" type="text" placeholder="Full Name *" class="input-field w-full" required />
        <input id="clientEmail" type="email" placeholder="Email *" class="input-field w-full" required />

        <div class="grid grid-cols-2 gap-3">
          <input id="activeProjects" type="number" placeholder="Active Projects" class="input-field" value="0" />
          <input id="filesShared" type="number" placeholder="Files Shared" class="input-field" value="0" />
          <input id="openInvoices" type="number" placeholder="Open Invoices" class="input-field" value="0" />
          <input id="lastUpdate" type="text" placeholder="Last Update" class="input-field" />
        </div>

        <!-- Toggleable Business Info -->
        <div>
          <button id="toggleBusinessFields" class="text-sm text-indigo-600 hover:underline mt-2">+ Add business details</button>
          <div id="businessFields" class="hidden mt-3 grid grid-cols-2 gap-3">
            <input id="company" type="text" placeholder="Company name" class="input-field" />
            <input id="manager" type="text" placeholder="Assigned manager" class="input-field" />
            <input id="phone" type="text" placeholder="Phone number" class="input-field" />
            <input id="website" type="text" placeholder="Website URL" class="input-field" />
          </div>
        </div>

        <textarea id="notes" placeholder="Any additional notes..." class="input-field w-full h-24"></textarea>
      </div>

      <!-- Buttons -->
      <div class="mt-6 flex justify-end gap-3">
        <button id="cancelCreateClient" class="px-4 py-2 text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white">Cancel</button>
        <button id="createClientBtn" class="px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-600/90 flex items-center gap-2">
          <span class="loader hidden border-2 border-t-transparent border-white rounded-full w-4 h-4 animate-spin"></span>
          Create Client
        </button>
      </div>
    </div>
  </div>

  <!-- New Client Modal -->
  <div id="newClientModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[2000] hidden transition-all duration-300" onclick="closeNewClientModalOnBackdrop(event)">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/50 max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col transform transition-all duration-300 scale-100" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="card-header flex items-center justify-between border-b border-slate-200/50 dark:border-slate-800/50 bg-gradient-to-r from-indigo-50/50 via-purple-50/50 to-pink-50/50 dark:from-indigo-950/20 dark:via-purple-950/20 dark:to-pink-950/20">
        <div>
          <h3 class="text-xl font-bold bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">Create New Client</h3>
          <p class="text-sm text-slate-500 dark:text-slate-400">Add a new client to the system</p>
        </div>
        <button onclick="closeNewClientModal()" class="btn-ghost text-xl hover:rotate-90 transition-transform duration-200">✕</button>
      </div>
      
      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Name *</label>
          <input type="text" id="newClientName" placeholder="Client Name" required class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Email *</label>
          <input type="email" id="newClientEmail" placeholder="client@example.com" required class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Active Projects</label>
            <input type="number" id="newClientProjects" value="0" placeholder="0" min="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Files Shared</label>
            <input type="number" id="newClientFiles" value="0" placeholder="0" min="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Open Invoices</label>
            <input type="number" id="newClientInvoices" value="0" placeholder="0" min="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Last Update</label>
            <input type="text" id="newClientLastUpdate" placeholder="e.g., Oct 2025 or leave blank for current date" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Notes (Optional)</label>
          <textarea id="newClientNotes" rows="3" placeholder="Any additional notes about this client..." class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
        </div>
      </div>
      
      <!-- Modal Footer -->
      <div class="card-header border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3">
        <button onclick="closeNewClientModal()" class="btn-ghost">Cancel</button>
        <button onclick="submitNewClient()" id="submitNewClientBtn" class="btn-primary">
          <span id="submitNewClientBtnText">Create Client</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Admin Project Workspace Modal -->
  <div id="projectModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-[2600]">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-8 relative transition-all duration-300">
      <button id="closeProjectModal" class="absolute top-4 right-5 text-slate-500 hover:text-slate-900">✕</button>

      <h2 id="projectTitle" class="text-xl font-semibold mb-3"></h2>
      <span id="projectStatusBadge" class="px-3 py-1 text-xs rounded-full bg-slate-100 text-slate-700"></span>

      <div id="projectEditFields" class="mt-6 space-y-4">
        <input id="editProjectTitle" type="text" placeholder="Project title" class="input-field w-full" />
        <textarea id="editProjectDescription" placeholder="Project description..." class="input-field w-full h-24"></textarea>
        <div class="grid grid-cols-2 gap-3">
          <select id="editProjectStatus" class="input-field">
            <option>In Progress</option>
            <option>Review</option>
            <option>Done</option>
          </select>
          <input id="editProjectDeadline" type="date" class="input-field" />
        </div>
      </div>

      <div class="mt-6 border-t pt-4">
        <h3 class="font-semibold mb-2 text-slate-700">Activity Log</h3>
        <div id="projectActivity" class="space-y-2 max-h-48 overflow-y-auto text-sm text-slate-600"></div>
      </div>

      <div class="mt-6 flex justify-end gap-3">
        <button id="cancelProjectChanges" class="px-4 py-2 text-slate-600 hover:text-slate-900">Cancel</button>
        <button id="saveProjectChanges" class="px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-600/90">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Invoice Builder Modal -->
  <div id="invoiceModal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-[2600]">
    <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-4xl p-6 sm:p-8 relative transition-all duration-300">
      <button id="invoiceModalClose" class="absolute top-4 right-5 text-slate-500 hover:text-slate-900">✕</button>
      <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-6">
        <div>
          <h3 class="flex items-center gap-2 text-xl font-semibold text-slate-900 dark:text-slate-100">
            <span class="text-indigo-500">🧾</span>
            Invoice Builder
          </h3>
          <p id="invoiceClientInfo" class="text-sm text-slate-500 dark:text-slate-400"></p>
        </div>
        <div class="text-right">
          <span class="block text-xs uppercase tracking-wide text-slate-400">Invoice #</span>
          <div id="invoiceNumberDisplay" class="text-lg font-semibold text-slate-900 dark:text-slate-100">INV-00000</div>
        </div>
      </div>

      <div class="grid gap-6 md:grid-cols-[minmax(0,2fr),minmax(0,1fr)]">
        <div class="space-y-6">
          <div>
            <label class="block text-xs font-semibold text-slate-500 mb-1">Notes (optional)</label>
            <textarea id="invoiceNotes" class="input-field w-full h-24" placeholder="Visible on the invoice footer"></textarea>
          </div>

          <div>
            <div class="flex items-center justify-between mb-2">
              <h4 class="font-semibold text-slate-700 dark:text-slate-200 flex items-center gap-2">
                <span class="text-indigo-500">➕</span>
                Line Items
              </h4>
              <button id="addInvoiceItem" class="btn-ghost text-sm flex items-center gap-2">
                <span class="text-indigo-500">➕</span>
                Add line
              </button>
            </div>
            <div class="hidden md:grid md:grid-cols-12 text-[11px] uppercase tracking-wide text-slate-400 px-2">
              <span class="md:col-span-6">Description</span>
              <span class="md:col-span-2 text-right">Qty</span>
              <span class="md:col-span-2 text-right">Price</span>
              <span class="md:col-span-2 text-right">Line Total</span>
            </div>
            <div id="invoiceItemsContainer" class="space-y-3 mt-2"></div>
          </div>
        </div>

        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-semibold text-slate-500 mb-1">Currency</label>
              <select id="invoiceCurrency" class="input-field w-full text-right">
                <option value="usd">USD</option>
                <option value="cad">CAD</option>
                <option value="eur">EUR</option>
                <option value="gbp">GBP</option>
                <option value="aud">AUD</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-semibold text-slate-500 mb-1">Due Date</label>
              <input id="invoiceDueDate" type="date" class="input-field w-full" />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-semibold text-slate-500 mb-1">Tax %</label>
              <input id="invoiceTaxRate" type="number" min="0" step="0.01" class="input-field w-full text-right" value="0" />
            </div>
            <div>
              <label class="block text-xs font-semibold text-slate-500 mb-1">Discount %</label>
              <input id="invoiceDiscountRate" type="number" min="0" step="0.01" class="input-field w-full text-right" value="0" />
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold text-slate-500 mb-1">Delivery</label>
            <div class="rounded-xl border border-slate-200 dark:border-slate-700 p-3 space-y-2">
              <label class="flex items-center gap-2 text-sm">
                <input type="radio" name="invoiceDelivery" id="invoiceSaveDraft" value="draft" />
                Save as draft
              </label>
              <label class="flex items-center gap-2 text-sm">
                <input type="radio" name="invoiceDelivery" id="invoiceSendNowRadio" value="send" checked />
                Send immediately
              </label>
            </div>
          </div>

          <div>
            <label class="block text-xs font-semibold text-slate-500 mb-1">Attachments</label>
            <input id="invoiceAttachments" type="file" class="input-field w-full" multiple accept=".pdf,.png,.jpg,.jpeg" />
            <ul id="invoiceAttachmentList" class="mt-2 space-y-2 text-sm text-slate-600 dark:text-slate-300"></ul>
          </div>

          <div class="border-t border-slate-200 dark:border-slate-700 pt-4 space-y-2">
            <div class="summary-line">
              <span>Subtotal</span>
              <span id="invoiceSubtotalValue">$0.00</span>
            </div>
            <div class="summary-line">
              <span>Tax</span>
              <span id="invoiceTaxValue">$0.00</span>
            </div>
            <div class="summary-line">
              <span>Discount</span>
              <span id="invoiceDiscountValue">-$0.00</span>
            </div>
            <div class="summary-line summary-total">
              <span>Total</span>
              <span id="invoiceTotalValue">$0.00</span>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6 flex justify-end gap-3">
        <button id="invoiceCancel" class="px-4 py-2 text-slate-600 hover:text-slate-900">Cancel</button>
        <button id="invoiceSubmit" class="px-5 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-600/90 flex items-center gap-2">
          <span class="hidden" id="invoiceSubmitSpinner">⏳</span>
          <span id="invoiceSubmitLabel">Create Invoice</span>
        </button>
      </div>
    </div>
  </div>
  <script>
    // Modal functions
    function closeModal() {
      document.getElementById('clientModal').classList.add('hidden');
    }
    
    function closeModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeModal();
      }
    }
    
    // New Client Modal functions
    function closeNewClientModal() {
      document.getElementById('newClientModal').classList.add('hidden');
    }
    
    function closeNewClientModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeNewClientModal();
      }
    }
    
    // Close on ESC key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
        closeNewClientModal();
        closeDeleteModal();
      }
    });
  </script>

  <!-- Loading Spinner -->
  <div id="loadingOverlay" class="fixed inset-0 flex items-center justify-center bg-slate-900/50 dark:bg-slate-950/80 backdrop-blur-sm z-[1000]">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl rounded-2xl p-8 shadow-2xl">
      <div class="animate-spin rounded-full h-12 w-12 border-4 border-gradient-to-r from-indigo-600 via-purple-600 to-indigo-600 border-t-transparent"></div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteConfirmModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[2500] hidden transition-all duration-300" onclick="closeDeleteModalOnBackdrop(event)">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/20 dark:border-slate-700/50 max-w-md w-full mx-4 overflow-hidden transform transition-all duration-300 scale-100" onclick="event.stopPropagation()">
      <div class="p-6">
        <div class="flex items-center gap-3 mb-4">
          <div class="size-12 rounded-full bg-red-100 dark:bg-red-900/40 flex items-center justify-center flex-shrink-0">
            <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
          </div>
          <div class="flex-1">
            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Remove Client</h3>
            <p class="text-sm text-slate-500 dark:text-slate-400">This action cannot be undone</p>
          </div>
        </div>
        
        <p class="text-slate-700 dark:text-slate-300 mb-6">
          Are you sure you want to remove <span id="deleteClientName" class="font-semibold text-slate-900 dark:text-white"></span>? This will permanently delete their record and revoke access.
        </p>
        
        <div class="flex gap-3">
          <button onclick="closeDeleteModal()" class="flex-1 btn-ghost">
            Cancel
          </button>
          <button onclick="deleteClientConfirmed()" id="confirmDeleteBtn" class="flex-1 inline-flex items-center justify-center rounded-xl px-4 py-2.5 bg-gradient-to-r from-red-600 to-red-700 text-white font-medium shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40 transition-all">
            <span id="confirmDeleteBtnText">Confirm Delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-full opacity-0">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-2xl shadow-2xl border border-white/20 dark:border-slate-700/50 px-6 py-4 flex items-center gap-3 min-w-[320px] max-w-md">
      <div class="flex-shrink-0">
        <div id="toastIcon" class="size-8 rounded-full flex items-center justify-center"></div>
      </div>
      <div class="flex-1">
        <div id="toastMessage" class="font-medium text-slate-900 dark:text-slate-100"></div>
        <div id="toastDetail" class="text-sm text-slate-600 dark:text-slate-400"></div>
      </div>
      <button onclick="hideToast()" class="flex-shrink-0 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">✕</button>
    </div>
  </div>

  <script>
    // Toast notification functions
    function showToast(message, type = 'success', detail = '') {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toastIcon');
      const toastMessage = document.getElementById('toastMessage');
      const toastDetail = document.getElementById('toastDetail');
      
      toastMessage.textContent = message;
      toastDetail.textContent = detail || '';
      
      // Set icon and colors based on type
      if (type === 'success') {
        toastIcon.innerHTML = '✓';
        toastIcon.className = 'size-9 rounded-full flex items-center justify-center bg-gradient-to-br from-emerald-400 to-emerald-600 text-white shadow-lg shadow-emerald-500/50';
        toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-0 opacity-100';
      } else if (type === 'error') {
        toastIcon.innerHTML = '✕';
        toastIcon.className = 'size-9 rounded-full flex items-center justify-center bg-gradient-to-br from-red-400 to-red-600 text-white shadow-lg shadow-red-500/50';
        toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-0 opacity-100';
      }
      
      // Auto-hide after 3 seconds
      setTimeout(() => hideToast(), 3000);
    }
    
    function hideToast() {
      const toast = document.getElementById('toast');
      toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-500 translate-x-full opacity-0';
    }
    
    // Make functions globally available
    window.showToast = showToast;
    window.hideToast = hideToast;
  </script>

  <!-- Lead Details Modal -->
  <div id="leadDetailsModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md flex items-center justify-center z-[3000] hidden transition-all duration-300" onclick="closeLeadDetailsModalOnBackdrop(event)">
    <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-2xl rounded-2xl shadow-2xl border border-white/20 dark:border-slate-700/50 max-w-2xl w-full mx-2 sm:mx-4 max-h-[95vh] overflow-hidden flex flex-col modal-slide-in" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="modal-header-gradient flex items-center justify-between px-4 sm:px-8 py-4 sm:py-6">
        <div>
          <h3 id="modalLeadName" class="text-lg sm:text-xl font-bold text-white">Lead Details</h3>
        </div>
        <button onclick="closeLeadDetailsModal()" class="text-white/80 hover:text-white hover:rotate-90 transition-transform duration-200 text-xl sm:text-2xl">✕</button>
      </div>
      
      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-4 sm:p-8 space-y-4 sm:space-y-6">
        <div class="grid grid-cols-1 gap-4 sm:gap-6">
          <div>
            <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Name</label>
            <p id="modalDetailName" class="text-slate-900 dark:text-white font-medium"></p>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Email</label>
            <p id="modalDetailEmail" class="text-slate-900 dark:text-white font-medium"></p>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Phone</label>
            <p id="modalDetailPhone" class="text-slate-900 dark:text-white font-medium"></p>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Service</label>
            <p id="modalDetailService" class="text-slate-900 dark:text-white font-medium"></p>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Message</label>
            <p id="modalDetailMessage" class="text-slate-900 dark:text-white font-medium whitespace-pre-wrap"></p>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Date</label>
            <p id="modalDetailDate" class="text-slate-900 dark:text-white font-medium"></p>
          </div>
        </div>
      </div>
      
      <!-- Modal Footer -->
      <div class="card-header border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3">
        <button onclick="closeLeadDetailsModal()" class="btn-primary">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Lead details modal functions
    function openLeadDetailsModal(lead) {
      const modal = document.getElementById('leadDetailsModal');
      const modalContent = modal.querySelector('.modal-slide-in');
      
      // Populate data
      document.getElementById('modalLeadName').textContent = lead.name || 'Lead Details';
      document.getElementById('modalDetailName').textContent = lead.name || 'N/A';
      document.getElementById('modalDetailEmail').textContent = lead.email || 'N/A';
      document.getElementById('modalDetailPhone').textContent = lead.phone || 'N/A';
      document.getElementById('modalDetailService').textContent = lead.service || 'N/A';
      document.getElementById('modalDetailMessage').textContent = lead.message || 'N/A';
      document.getElementById('modalDetailDate').textContent = lead.created_at ? new Date(lead.created_at).toLocaleString() : 'N/A';
      
      // Show modal with animation
      modal.classList.remove('hidden');
      modalContent.classList.add('modal-slide-in');
    }
    
    function closeLeadDetailsModal() {
      const modal = document.getElementById('leadDetailsModal');
      const modalContent = modal.querySelector('.modal-slide-in');
      
      // Add fade-out animation
      modalContent.classList.add('modal-slide-out');
      
      setTimeout(() => {
        modal.classList.add('hidden');
        modalContent.classList.remove('modal-slide-out');
      }, 300);
    }
    
    function closeLeadDetailsModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeLeadDetailsModal();
      }
    }
    
    window.openLeadDetailsModal = openLeadDetailsModal;
    window.closeLeadDetailsModal = closeLeadDetailsModal;
    window.closeLeadDetailsModalOnBackdrop = closeLeadDetailsModalOnBackdrop;
  </script>
</body>
</html>

