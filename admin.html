<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brandible Hub ‚Äì Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.init();
    }
  </script>
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <script defer src="/assets/js/auth.js"></script>
  <script defer src="/assets/js/admin.js"></script>

  <!-- Tailwind component layer -->
  <style type="text/tailwindcss">
    @layer components {
      .pill { @apply inline-flex items-center gap-1 px-2 py-1 text-xs rounded-full font-medium; }
      .pill-green { @apply pill bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300; }
      .pill-amber { @apply pill bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300; }
      .pill-blue { @apply pill bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-300; }
      .pill-slate { @apply pill bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300; }
      .card-body { @apply p-4 md:p-5; }
      .sidebar-link { @apply flex items-center gap-3 px-3 py-2 rounded-xl text-slate-600 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-white; }
      .sidebar-link-active { @apply bg-slate-900 text-white dark:bg-white dark:text-slate-900; }
    }
  </style>

  <script>
    // Dark mode toggle + persist
    (function(){
      const key = 'brandible.dark';
      const saved = localStorage.getItem(key);
      if (saved === '1') document.documentElement.classList.add('dark');
      window.toggleDark = () => {
        const d = document.documentElement.classList.toggle('dark');
        localStorage.setItem(key, d ? '1' : '0');
      }
    })();
  </script>
</head>
<body class="h-full bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100">
  <div class="min-h-screen flex flex-col">
    <!-- Topbar -->
    <header class="bg-white/80 dark:bg-slate-900/60 backdrop-blur border-b border-slate-200 dark:border-slate-800 sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="size-9 rounded-xl bg-indigo-600"></div>
          <div>
            <div class="font-semibold">Brandible Hub</div>
            <div class="text-xs text-slate-500">Admin Dashboard</div>
          </div>
        </div>
        <div class="flex items-center gap-3">
          <span id="userEmail" class="text-sm text-slate-500"></span>
          <span class="pill-blue">Admin</span>
          <button onclick="toggleDark()" class="btn-ghost" title="Dark mode">üåó</button>
          <button id="logoutBtn" class="btn-ghost">Log out</button>
        </div>
      </div>
    </header>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 py-6 space-y-8">
      <!-- Admin KPIs -->
      <section>
        <h2 class="text-2xl font-bold mb-4">Overview</h2>
        <div id="adminKPIs" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
      </section>

      <!-- Clients List -->
      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-bold">All Clients</h2>
          <div class="flex items-center gap-3">
            <input id="clientSearch" placeholder="Search clients..." class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white/70 dark:bg-slate-900/50 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
            <button onclick="openNewClientModal()" class="btn-primary">
              + New Client
            </button>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">Client List</div>
          <div class="card-body overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="text-slate-500">
                <tr>
                  <th class="text-left py-2">Name</th>
                  <th class="text-left py-2">Email</th>
                  <th class="text-left py-2">Active Projects</th>
                  <th class="text-left py-2">Open Invoices</th>
                  <th class="text-left py-2">Last Update</th>
                  <th class="text-right py-2">Actions</th>
                </tr>
              </thead>
              <tbody id="clientsTable"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Recent Activity Across All Clients -->
      <section>
        <h2 class="text-2xl font-bold mb-4">Recent Activity</h2>
        <div class="card">
          <ul id="allActivity" class="card-body space-y-3"></ul>
        </div>
      </section>
    </main>

    <footer class="px-4 py-6 text-center text-xs text-slate-500">
      ¬© <span id="year"></span> Brandible. All rights reserved.
    </footer>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- Client Profile Modal -->
  <div id="clientModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[2000] hidden" onclick="closeModalOnBackdrop(event)">
    <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="card-header flex items-center justify-between border-b border-slate-200 dark:border-slate-800">
        <div>
          <h3 id="modalClientName" class="text-xl font-bold">Client Name</h3>
          <p id="modalClientEmail" class="text-sm text-slate-500"></p>
        </div>
        <div class="flex items-center gap-2">
          <button id="editBtn" onclick="toggleEditMode()" class="btn-ghost">Edit</button>
          <button onclick="closeModal()" class="btn-ghost text-xl">‚úï</button>
        </div>
      </div>
      
      <!-- Edit Mode Header -->
      <div id="editModeHeader" class="hidden card-header flex items-center justify-between border-b-2 border-indigo-500 bg-indigo-50 dark:bg-indigo-950">
        <div class="flex items-center gap-2">
          <span class="text-indigo-700 dark:text-indigo-300 font-medium">‚úèÔ∏è Edit Mode</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="cancelEditBtn" onclick="cancelEditMode()" class="btn-ghost">Cancel</button>
          <button id="saveBtn" onclick="saveClientChanges()" class="btn-primary">
            <span id="saveBtnText">Save Changes</span>
          </button>
        </div>
      </div>
      
      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-6 space-y-6">
        <!-- KPIs -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Overview</h4>
          <div id="modalKPIs" class="grid grid-cols-2 gap-4"></div>
        </section>
        
        <!-- Projects -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Projects</h4>
          <div id="modalProjects" class="space-y-3"></div>
        </section>
        
        <!-- Files -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Files</h4>
          <ul id="modalFiles" class="space-y-2"></ul>
        </section>
        
        <!-- Invoices -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Invoices</h4>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead class="text-slate-500">
                <tr>
                  <th class="text-left py-2">#</th>
                  <th class="text-left py-2">Date</th>
                  <th class="text-left py-2">Amount</th>
                  <th class="text-left py-2">Status</th>
                </tr>
              </thead>
              <tbody id="modalInvoices"></tbody>
            </table>
          </div>
        </section>
        
        <!-- Activity -->
        <section>
          <h4 class="text-lg font-semibold mb-3">Recent Activity</h4>
          <ul id="modalActivity" class="space-y-2"></ul>
        </section>
        
        <!-- Updates -->
        <section id="modalUpdatesSection">
          <h4 class="text-lg font-semibold mb-3">Updates</h4>
          <ul id="modalUpdates" class="space-y-2"></ul>
        </section>
        
        <!-- Edit Section: KPIs -->
        <section id="editKPIsSection" class="hidden">
          <h4 class="text-lg font-semibold mb-3 text-indigo-700 dark:text-indigo-300">Edit KPIs</h4>
          <div class="card p-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Active Projects</label>
                <input type="number" id="editKPIProjects" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Files Shared</label>
                <input type="number" id="editKPIFiles" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Open Invoices</label>
                <input type="number" id="editKPIInvoices" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" />
              </div>
              <div>
                <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Last Update</label>
                <input type="text" id="editKPILastUpdate" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" placeholder="e.g., Oct 3, 2025" />
              </div>
            </div>
          </div>
        </section>
        
        <!-- Edit Section: Add Activity -->
        <section id="editActivitySection" class="hidden">
          <h4 class="text-lg font-semibold mb-3 text-indigo-700 dark:text-indigo-300">Add Activity</h4>
          <div class="card p-4 space-y-4">
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Activity Type</label>
              <select id="newActivityType" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1">
                <option value="project">Project</option>
                <option value="file">File</option>
                <option value="invoice">Invoice</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">Activity Description</label>
              <input type="text" id="newActivityText" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" placeholder="e.g., Uploaded new design file" />
            </div>
            <div>
              <label class="text-sm font-medium text-slate-700 dark:text-slate-300">When</label>
              <input type="text" id="newActivityWhen" class="w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 mt-1" placeholder="e.g., 2 days ago" />
            </div>
            <button onclick="addActivityToClient()" class="btn-primary w-full">Add Activity</button>
          </div>
        </section>
      </div>
      
      <!-- Modal Footer -->
      <div class="card-header border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3">
        <button onclick="closeModal()" class="btn-primary">Close</button>
      </div>
    </div>
  </div>

  <!-- New Client Modal -->
  <div id="newClientModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[2000] hidden" onclick="closeNewClientModalOnBackdrop(event)">
    <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="card-header flex items-center justify-between border-b border-slate-200 dark:border-slate-800">
        <div>
          <h3 class="text-xl font-bold">Create New Client</h3>
          <p class="text-sm text-slate-500">Add a new client to the system</p>
        </div>
        <button onclick="closeNewClientModal()" class="btn-ghost text-xl">‚úï</button>
      </div>
      
      <!-- Modal Body -->
      <div class="flex-1 overflow-y-auto p-6 space-y-4">
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Name *</label>
          <input type="text" id="newClientName" placeholder="Client Name" required class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Email *</label>
          <input type="email" id="newClientEmail" placeholder="client@example.com" required class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Active Projects</label>
            <input type="number" id="newClientProjects" value="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Files Shared</label>
            <input type="number" id="newClientFiles" value="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Open Invoices</label>
            <input type="number" id="newClientInvoices" value="0" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
          <div>
            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Last Update</label>
            <input type="text" id="newClientLastUpdate" placeholder="e.g., Oct 2025" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500" />
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Notes (Optional)</label>
          <textarea id="newClientNotes" rows="3" placeholder="Any additional notes about this client..." class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
        </div>
      </div>
      
      <!-- Modal Footer -->
      <div class="card-header border-t border-slate-200 dark:border-slate-800 flex justify-end gap-3">
        <button onclick="closeNewClientModal()" class="btn-ghost">Cancel</button>
        <button onclick="submitNewClient()" id="submitNewClientBtn" class="btn-primary">
          <span id="submitNewClientBtnText">Create Client</span>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Modal functions
    function closeModal() {
      document.getElementById('clientModal').classList.add('hidden');
    }
    
    function closeModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeModal();
      }
    }
    
    // New Client Modal functions
    function closeNewClientModal() {
      document.getElementById('newClientModal').classList.add('hidden');
    }
    
    function closeNewClientModalOnBackdrop(event) {
      if (event.target === event.currentTarget) {
        closeNewClientModal();
      }
    }
    
    // Close on ESC key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
        closeNewClientModal();
      }
    });
  </script>

  <!-- Loading Spinner -->
  <div id="loadingOverlay" class="fixed inset-0 flex items-center justify-center bg-white/80 dark:bg-slate-950/80 z-[1000]">
    <div class="animate-spin rounded-full h-12 w-12 border-4 border-indigo-600 border-t-transparent"></div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed top-4 right-4 z-[3000] transform transition-all duration-300 translate-x-full opacity-0">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center gap-3 min-w-[300px]">
      <div class="flex-shrink-0">
        <div id="toastIcon" class="size-8 rounded-full flex items-center justify-center"></div>
      </div>
      <div class="flex-1">
        <div id="toastMessage" class="font-medium text-slate-900 dark:text-slate-100"></div>
        <div id="toastDetail" class="text-sm text-slate-600 dark:text-slate-400"></div>
      </div>
      <button onclick="hideToast()" class="flex-shrink-0 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">‚úï</button>
    </div>
  </div>

  <script>
    // Toast notification functions
    function showToast(message, type = 'success', detail = '') {
      const toast = document.getElementById('toast');
      const toastIcon = document.getElementById('toastIcon');
      const toastMessage = document.getElementById('toastMessage');
      const toastDetail = document.getElementById('toastDetail');
      
      toastMessage.textContent = message;
      toastDetail.textContent = detail || '';
      
      // Set icon and colors based on type
      if (type === 'success') {
        toastIcon.innerHTML = '‚úì';
        toastIcon.className = 'size-8 rounded-full flex items-center justify-center bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300';
        toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-300 translate-x-0 opacity-100';
      } else if (type === 'error') {
        toastIcon.innerHTML = '‚úï';
        toastIcon.className = 'size-8 rounded-full flex items-center justify-center bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300';
        toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-300 translate-x-0 opacity-100';
      }
      
      // Auto-hide after 5 seconds
      setTimeout(() => hideToast(), 5000);
    }
    
    function hideToast() {
      const toast = document.getElementById('toast');
      toast.className = 'fixed top-4 right-4 z-[3000] transform transition-all duration-300 translate-x-full opacity-0';
    }
    
    // Make functions globally available
    window.showToast = showToast;
    window.hideToast = hideToast;
  </script>
</body>
</html>

